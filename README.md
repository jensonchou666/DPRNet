The code needs to be sorted out, and will be posted soon